{% extends "base.html" %}

{% block title %} webtrack: task view {% endblock %}

{% block content %}

	{% if form.errors %}
		<p class="error">Sorry, that's not a valid username/password</p>
	{% endif %}

	{% if messages %}
    	{% for message in messages %}
			{% if message.tags == 'error' %}
    			<div class="alert alert-danger">
			{% elif message.tags == 'warning' %}
				<div class="alert alert-warning">
			{% else %}
				<div class="alert alert-info">
			{% endif %}
							
    		<button type="button" class="close" data-dismiss="alert">&times;</button>
    			{{ message }}
    		</div>
    	{% endfor %}
	{% endif %}
	<h2>Task: {{task.summary}} {%if task.completed%}(Completed){%endif%}</h2>
	<p>{{task.description}}</p>

	<p><em>Opened by {{task.creator}} {%if canEdit %}<a href="/projects/task/edit/{{task.id}}">(Edit/Delete)</a>{%endif%}</em></p>


	<h3>Projects this task belongs to</h3>

		<table class="table table-striped">
			<tr>
				<th>Project</th>
				<th>Manager</th>
				<th>Description</th>
				<th>Manage</th>
			</tr>

			{% for p in openOn %}

			<tr>
				<td><a href="/projects/view/{{p.id}}/">{{p.name}}</a></td>
				<td>{{p.manager}}</td>
				<td>{{p.description}}</td>

				<td><a class="btn btn-warning" href="/projects/{{p.id}}/closetask/{{task.id}}/">Mark Completed in Project</a></td>
			</tr>

			{% endfor %}

			{% for p in closedOn %}

			<tr>
				<td><a href="/projects/view/{{p.id}}/">{{p.name}}</a></td>
				<td>{{p.manager}}</td>
				<td>{{p.description}}</td>

				<td><a class="btn btn-default" href="/projects/{{p.id}}/opentask/{{task.id}}/">Mark Unfinished in Project</a></td>
			</tr>

			{% endfor %}

			<tr>
				<td colspan="4"><a href="/projects/addtotask/{{task.id}}/">Assign to Another Project</a></td>

		</table>

		<hr />

	<h3>Task Assignees</h3>
		<table class="table table-striped">
			<tr>
				<th>Assignee</th>
				<th>Manage</th>
			</tr>

			{% for u in members %}

			<tr>
			<td>{{u}}</td>
			<td> {%if canEdit %} <a class="btn btn-danger" href="/projects/task/removemember/{{task.id}}/{{u.id}}/">Unassign</a> {%endif%}</td>
			</tr>
			{% endfor %}

			<tr>

			<td>

			<form id="addProjectMember" action="/projects/task/addmember/{{task.id}}/" method="POST">{% csrf_token %}

			{% for field in add_member_form %}

				{{field}}

			{% endfor %}

			</td>
			<td><input type="submit" class="btn btn-success" value="Assign">
						</form>

		</tr>


		</table>

	</div>



{% endblock %}