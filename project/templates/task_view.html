{% extends "base.html" %}

{% block title %} webtrack: task view {% endblock %}

{% block content %}

	{% if form.errors %}
		<p class="error">Sorry, that's not a valid username/password</p>
	{% endif %}

	{% if messages %}
    	{% for message in messages %}
			{% if message.tags == 'error' %}
    			<div class="alert alert-danger">
			{% elif message.tags == 'warning' %}
				<div class="alert alert-warning">
			{% else %}
				<div class="alert alert-info">
			{% endif %}
							
    		<button type="button" class="close" data-dismiss="alert">&times;</button>
    			{{ message }}
    		</div>
    	{% endfor %}
	{% endif %}
	<h2><img src="/static/img/task.png" />Task: {{task.summary}} {%if task.completed%}(Completed){%endif%}</h2>
	<p>{{task.description}}</p>
	{%if canEdit %}
		<a class="btn btn-info" href="/projects/task/edit/{{task.id}}">Edit Task</a>
		{% if not task.inProgress %}
		<a class="btn btn-warning" href="/projects/task/inprogress/{{task.id}}">Mark In Progress</a>
		{% else %}
		<a class="btn btn-warning" href="/projects/task/inprogress/{{task.id}}">Mark Not In Progress</a>
		{% endif %}
		<a class="btn btn-danger" href="/projects/task/delete/{{task.id}}">Delete Task</a>

		<!--
		{% if task.active %}
			<a class="btn btn-warning" href="/projects/task/toggle/{{task.id}}/">Mark as In Progress </a>
			{% else %}
			<a class="btn btn-warning" href="/projects/toggle/{{project.id}}/">Re-open Task</a>
			{% endif %}
		<a class="btn btn-warning" href="/projects/task/close/{{task.id}}">Close Task</a>
	-->
	{%endif%}

	<p><em>Opened by {{task.creator}} </em>

	</p>


	<h3><img src="/static/img/project.png" />Projects this task belongs to</h3>

		<table class="table table-striped">
			<tr>
				<th>Project</th>
				<th>Manager</th>
				<th>Description</th>
				<th>Manage</th>
				<th>Remove</th>
			</tr>

			{% for p in openOn %}

			<tr>
				<td>
					{% if user in p.members.all %}
					<a href="/projects/view/{{p.id}}/">{{p.name}}</a>
					{% else %}
					<p>{{p.name}}</p>
					{% endif %}
				</td>
				<td>{{p.manager}}</td>
				<td>{{p.description}}</td>

				<td>
					{% if user in p.members.all %}
					<a class="btn btn-warning" href="/projects/{{p.id}}/closetask/{{task.id}}/">Mark Task Completed</a>
					{% else %}
					<p>Currently Open</p>
					{% endif %}
				</td>

				<td>
					{% if user in p.members.all %}
					<a class="btn btn-danger" href="/projects/{{p.id}}/unassigntask/{{task.id}}/">Remove</a>
					{% else %}
					<p>You are not a project member.</p>
					{% endif %}
				</td>
			</tr>

			{% endfor %}

			{% for p in closedOn %}

			<tr>
				<td><a href="/projects/view/{{p.id}}/">{{p.name}}</a></td>
				<td>{{p.manager}}</td>
				<td>{{p.description}}</td>

				<td>
					{% if user in p.members.all %}
					<a class="btn btn-default" href="/projects/{{p.id}}/opentask/{{task.id}}/">Mark Unfinished</a>
					{% else %}
					<p>Currently Closed</p>
					{% endif %}
				</td>
			</tr>

			{% endfor %}

			<tr>
				<td colspan="5"><a href="/projects/addtotask/{{task.id}}/">Assign to Another Project</a></td>

		</table>

		<hr />

	<h3><img src="/static/img/members.png" />Task Assignees</h3>
		<table class="table table-striped">
			<tr>
				<th>Assignee</th>
				<th>Manage</th>
			</tr>

			{% for u in members %}

			<tr>
			<td>{{u}}</td>
			<td> {%if canEdit %} <a class="btn btn-danger" href="/projects/task/removemember/{{task.id}}/{{u.id}}/">Unassign</a> {%endif%}</td>
			</tr>
			{% endfor %}

			<tr>

			<td>

			<form id="addProjectMember" action="/projects/task/addmember/{{task.id}}/" method="POST">{% csrf_token %}

			{% for field in add_member_form %}

				{{field}}

			{% endfor %}

			</td>
			<td><input type="submit" class="btn btn-success" value="Assign">
						</form>

		</tr>


		</table>

	</div>



{% endblock %}